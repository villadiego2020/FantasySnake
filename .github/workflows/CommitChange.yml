name: Notify Discord on Dev Push

on:
  push:
    branches:
      - Main  # Trigger ‡πÄ‡∏°‡∏∑‡πà‡∏≠ push ‡πÄ‡∏Ç‡πâ‡∏≤ branch dev

jobs:
  discord_notify:
    name: Send Commit Title to Discord
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ‡∏î‡∏∂‡∏á Commit History ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

      - name: Get Commit Title
        id: commit_title
        run: |
          echo "Extracting latest commit title..."
          commit_title=$(git log -1 --pretty=format:"%s" | sed 's/"/\\"/g')
          echo "commit_title=$commit_title" >> $GITHUB_ENV

      - name: Debug - Show Commit Title
        run: |
          echo "Latest Commit Title: ${{ env.commit_title }}"

      - name: Send Commit Title to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          PAYLOAD=$(jq -n \
            --arg username "GitHub Actions" \
            --arg content "**üÜï New Push to `dev` Branch**\nüìå **Latest Commit:** `${{ env.commit_title }}`" \
            '{ "username": $username, "content": $content }')

          echo "$PAYLOAD"  # Debug JSON ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏õ Discord

          curl -H "Content-Type: application/json" -X POST -d "$PAYLOAD" "${DISCORD_WEBHOOK}"

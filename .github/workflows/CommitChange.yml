name: Notify Discord on Dev Push

on:
  push:
    branches:
      - main  # Trigger ‡πÄ‡∏°‡∏∑‡πà‡∏≠ push ‡πÄ‡∏Ç‡πâ‡∏≤ branch dev

jobs:
  discord_notify:
    name: Send Commit Messages to Discord
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ Commit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà Push ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÑ‡∏î‡πâ

      - name: Get Commit Messages
        id: commit_messages
        run: |
          echo "Generating commit messages..."
          commits=$(git log --format='- %s' ${{ github.event.before }}..${{ github.sha }} | sed ':a;N;$!ba;s/\n/\\n/g')
          echo "commit_messages=$(echo "$commits" | jq -sR .)" >> $GITHUB_ENV

      - name: Debug - Show Commit Messages
        run: |
          echo "Commit Messages:"
          echo "${{ env.commit_messages }}"

      - name: Send Commit Messages to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          PAYLOAD=$(jq -n \
            --arg username "GitHub Actions" \
            --arg avatar_url "https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" \
            --arg content "**üöÄ New Push to dev Branch!**\n\n**üìù Commit Messages:**\n$(echo "${{ env.commit_messages }}" | jq -r .)" \
            '{ "username": $username, "avatar_url": $avatar_url, "content": $content }')

          echo "$PAYLOAD"  # Debug JSON ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏õ Discord

          curl -H "Content-Type: application/json" -X POST -d "$PAYLOAD" "${DISCORD_WEBHOOK}"
